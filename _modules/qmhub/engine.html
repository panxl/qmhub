<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>qmhub.engine &mdash; QMHub  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            QMHub
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CommandLine.html">Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PythonModule.html">Python Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Installation.html">Installation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">QMHub</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">qmhub.engine</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for qmhub.engine</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">.qmtools</span> <span class="kn">import</span> <span class="n">QM</span>
<span class="kn">from</span> <span class="nn">.utils.darray</span> <span class="kn">import</span> <span class="n">DependArray</span>

<div class="viewcode-block" id="Engine"><a class="viewcode-back" href="../../api.html#qmhub.engine.Engine">[docs]</a><span class="k">class</span> <span class="nc">Engine</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;QMHub Engine object&#39;&#39;&#39;</span>
<div class="viewcode-block" id="Engine.__init__"><a class="viewcode-back" href="../../api.html#qmhub.engine.Engine.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">qm_positions</span><span class="p">,</span>
        <span class="n">qm_elements</span><span class="p">,</span>
        <span class="n">mm_positions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">mm_charges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">charge</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">mult</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an Engine object for QM simulations; which stores the elements and positions of the QM simulation, and optionally the positions and charges from the MM simulation. Also creates energy arrays and energy gradients arrays particular to the QM system.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            qm_positions ():</span>
<span class="sd">            qm_elements ():</span>
<span class="sd">            mm_positions (optional):</span>
<span class="sd">            mm_charges (optional):</span>
<span class="sd">            charge (optional):</span>
<span class="sd">            mult (optional):</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">qm_positions</span> <span class="o">=</span> <span class="n">qm_positions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qm_elements</span> <span class="o">=</span> <span class="n">qm_elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mm_positions</span> <span class="o">=</span> <span class="n">mm_positions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mm_charges</span> <span class="o">=</span> <span class="n">mm_charges</span>

        <span class="k">if</span> <span class="n">charge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="n">charge</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please set &#39;charge&#39; for QM calculation.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mult</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mult</span> <span class="o">=</span> <span class="n">mult</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">engines</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">qm_energy</span> <span class="o">=</span> <span class="n">DependArray</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;qm_energy&quot;</span><span class="p">,</span>
            <span class="n">func</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">args</span><span class="p">)),</span>
            <span class="n">dependencies</span><span class="o">=</span><span class="p">[],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qm_energy_gradient</span> <span class="o">=</span> <span class="n">DependArray</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;qm_energy_gradient&quot;</span><span class="p">,</span>
            <span class="n">func</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">args</span><span class="p">)),</span>
            <span class="n">dependencies</span><span class="o">=</span><span class="p">[],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mm_esp</span> <span class="o">=</span> <span class="n">DependArray</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mm_esp&quot;</span><span class="p">,</span>
            <span class="n">func</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">args</span><span class="p">)),</span>
            <span class="n">dependencies</span><span class="o">=</span><span class="p">[],</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Engine.add_engine"><a class="viewcode-back" href="../../api.html#qmhub.engine.Engine.add_engine">[docs]</a>    <span class="k">def</span> <span class="nf">add_engine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Attaches an given engine to the dictionary of the Engine object, i.e. the set of engines; allowing for the results of different engines to be added together for additional module components, e.g. error correction.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            engine (Engine):</span>
<span class="sd">            name (str, optional):</span>
<span class="sd">            cwd (optional):</span>
<span class="sd">            options (str, optional):</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">engine</span>

        <span class="n">engine_obj</span> <span class="o">=</span> <span class="n">QM</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">engine</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
            <span class="n">qm_positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qm_positions</span><span class="p">,</span>
            <span class="n">qm_elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qm_elements</span><span class="p">,</span>
            <span class="n">mm_positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm_positions</span><span class="p">,</span>
            <span class="n">mm_charges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm_charges</span><span class="p">,</span>
            <span class="n">charge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mult</span><span class="p">,</span>
            <span class="n">cwd</span> <span class="o">=</span> <span class="n">cwd</span><span class="p">,</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">engine_obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">engines</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">engine_obj</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">qm_energy</span><span class="o">.</span><span class="n">add_dependency</span><span class="p">(</span><span class="n">engine_obj</span><span class="o">.</span><span class="n">qm_energy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qm_energy_gradient</span><span class="o">.</span><span class="n">add_dependency</span><span class="p">(</span><span class="n">engine_obj</span><span class="o">.</span><span class="n">qm_energy_gradient</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mm_esp</span><span class="o">.</span><span class="n">add_dependency</span><span class="p">(</span><span class="n">engine_obj</span><span class="o">.</span><span class="n">mm_esp</span><span class="p">)</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Xiaoliang Pan. Project structure based on the Computational Molecular Science Python Cookiecutter version 1.1.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>